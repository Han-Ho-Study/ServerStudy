# Week 4 / 2장 컴퓨터 네트워크(2.1장~2.9장)

## 2.1 컴퓨터 네트워크를 구성하는 기기
- OSI모델(컴퓨터 네트워크 통신에 대한 국제 표준)만 잘 지키면 어떤 기기든 컴퓨터 간 통신이 가능
- 성립하려면 Layer 2를 지켜줘야함

- OSI 모델
  - 계층 1(물리) : 하드웨어
  - 계층 2(데이터 링크) : LAN에서 통신을 가능하게 함
  - 계층 3(네트워크) : WAN에서 통신을 가능하게 함
  - 계층 4(전송) : 상대방에게 데이터가 반드시 도착하게 함
  - 계층 5(세션), 계층 6(표현), 계층 7(응용)
    - 응용 프로그램이나 운영체제 안 모듈이 다른 컴퓨터의 응용프로그램이나 운영체제 모듈과 통신을 하는 동안 논리적 연결 단위나 기능
    - 스트리밍의 통신규약(MPEG), 통신 암호화 규약(SSL), 웹 브라우저와 웹 서버 간 통신 규약(HTTP) 등

    ![01](https://github.com/Han-Ho-Study/ServerStudy/blob/main/한수/server/Image/week4_image1.png)
  
- 계층 2
  - 각 단말기는 고유한 주소를 갖는다
  - 데이터 단위 : 프레임(Frame)
  - 페이로드(Payload) : 보내고자하는 데이터
    
    ![02](https://github.com/Han-Ho-Study/ServerStudy/blob/main/한수/server/Image/week4_image2.jpg)

- 계층 3
  - IP(Internet Protocol)를 사용
  - 데이터 단위 : 패킷(Packet)

## 2.2 인터넷
- IP규약을 지키면 기기 종류와 상관없이 서로 통신이 가능

## 2.3 컴퓨터 네트워크 데이터
- 스트림(Stream) 형식
  - 두 단말기를 연결한 후 그 연결을 끊기 전까지 한쪽에서 다른 한쪽으로 연결된 데이터 흐름 하나를 일컫는말
  - 스트림 형식으로 송수신된 데이터는 헤더를 붙이는 방식, 구분자(Delimiter)를 이용하는 방식이 있음
- 메시지 형식
  - 자체적으로 데이터 시작과 끝을 구별할 수 있음
  - 여러 필드(Field)로 나누어서 사용
  - 네트워크 게임에서 특정 시점 사건을 알리는 경우가 많아 메시지 형식이 보편적
  - 네트워크 스택 : 운영체제에 내장된 네트워크 모듈, 보내고 받는 스트림과 메시지를 관리
    - 매우 긴 스트림을 송신 할때는 IP 패킷의 크기 제한에 맞추어 단편화(Fragmentation) 함

## 2.4 컴퓨터 네트워크 식별자
- Port : 한 IP 주소 안에서도 누가 주고 받는지 식별
- DNS : 호스트 이름을 IP주소로 바꾸어줌

## 2.5 컴퓨터 네트워크의 품질과 특성
- 네트워크의 품질을 저해하는 것들
  - 네트워크 기기에 과부하가 걸리면 초과분을 버림
  - 물리적인 신호 불량이 발생할 경우 계층2, 계층3에서 체크섬을 통하여 버려짐
- 전송 속도와 전송 지연 시간
  - 전송 속도(Throughput) : 두 기기 간에 초당 전송될 수 있는 최대 데이터 양
    - 영향을 주는 것 : 선로의 종류와 품질, 소프트웨어와 하드웨어 종류
    - 두 단말기 사이의 네트워크 기기중 최소 스루풋
  - 레이턴시(Latency) : 두 기기 간에 데이터를 최소량 전송할때 걸리는 시간
    - 영향을 주는 것 : 매체의 종류와 품질, 송-수진자 사이의 라우터 처리 속도
    - 매체 품질에 의한 재전송도 레이턴시로 이어짐
    - 방화벽이 받은 패킷이 악성 데이터를 가지고 있는지 연산하는것도 레이턴시 증가로 이어짐
    - 두 단말기 사이에 있는 네트워크 기기의 레이턴시 총합
- 네트워크 품질 기준 세 가지
  - 전송 속도 : 전송될 수 있는 데이터의 단위 시간당 총량
  - 패킷 유실률 : 전송되는 데이터가 중간에 버려지는 비율
  - 레이턴시 : 전성되는 데이터가 목적지에 도착하는데 걸리는 시간
- 무선 네트워크의 품질
  - CSMA(Carrier Sense Multiple Access)
    - 먼저 매체가 사용중인지 확인(Carrier Sensing)하며 다중속(Multiple Access)하는 방식
    - 동작 방식 예
      - 데이터를 전파로 변환하여 보내기 직전 안테나를 통해 다른 전파를 감지
      - 감지되는것이 없으면 전파
      - 전파가 감전되면 잠시기다렸다가 위 두가지를 반복
      - 신호를 보낸 후 상대방에게서 받았다는 응답을 체크
      - 응답이 일정 시간 안오면 신호를 다시 보냄
   
## 2.6 컴퓨터 네트워크에서 데이터 보내기와 받기
- UDP(User Datagram Protocol) : 사용자가 정의한 데이터그램을 상대방에게 보낼수 있게 하는 통신규약
  - 사용법이 간단한 반면, 데이터 유실 또는 순서 뒤바뀜 같은 문제가 생긴다는 단점이 있음
- TCP(Transmission Control Protocol) 네트워킹
  - 흐름제어기능(Data flow control) : 상대방이 받았다는 응답이 올때까지 세그먼트를 보냄
  - 송수신을 위한 소켓을 따로 만들 필요가 없음
  - 스트림 형식이다보니 받을때마다 부분데이터라도 필요한 처리를 하면 됨

## 2.7 패킷 유실 시 UDP와 TCP에서 현상
- UDP : 유실이 발생하면 데이터그램 자체가 유실
  - 평균 레이턴시 : 네트워크 기기의 레이턴시
- TCP : 유실이 발생하면 중간에 지연 시간이 발생
  - 평균 레이턴시 : 네트워크 기기의 레이턴시 + 패킷 유실률 * 재전송 대기시간
  - Sequence number를 통하여 순서를 보장함
  - Sequence number 공식 = SEQ + (Data Size)

  - Stop and Wait ARQ : 송신측에서 1개의 프레임을 송신하고, 수신측에서 수신된 프레임의 에러 유무 판단에 따라 ACK or NAK(Negative Acknowledgement)를 보내는 방식
    
    ![03](https://github.com/Han-Ho-Study/ServerStudy/blob/main/한수/server/Image/week4_image3.png)
    
  - Go-Back-n ARQ(슬라이딩 윈도우) : 전송된 프레임이 손상되거나 분실된 경우 또는 ACK 이 손실되어 TIME_OUT이 발생한 경우 확인된 마지막 프레임 이후로 모든 프레임을 재전송
    
    ![04](https://github.com/Han-Ho-Study/ServerStudy/blob/main/한수/server/Image/week4_image4.png)
    ![05](https://github.com/Han-Ho-Study/ServerStudy/blob/main/한수/server/Image/week4_image4_2.webp)
    
  - SR(Selective-Reject) ARQ : Go-Back-N ARQ 의 단점을 보완한 방식, 손상되거나 손실된 프레임만 재전송
    - 데이터 재정렬을 수행해야하며 별도의 버퍼를 필요
    - 수신 측에서는 이 버퍼로 데이터를 정렬
      
    ![06](https://github.com/Han-Ho-Study/ServerStudy/blob/main/한수/server/Image/week4_image5.png)

## 2.8 주로 사용하는 메시지 형식
- 과거에는 메시지를 받는쪽에서 글자 검색을 하거나 구문 분석기(Parser)를 동원하였음
- 요즘은 표준화된 형식을 사용(HTTP, JSON)
- 바이너리 형식
  - 장점 : 구문 분석기가 필요없음, 처리 성능이 더 낮음, 통신량 적음, 해커가 접근하기 어려움
  - 단점 : 디버깅이 어려움
- 메타데이터를 포함한 형식
  - 장점 : 하위 호환성 측면에서 유리
  - 단점 : 통신량이 많아지고, 해커에게 쉽게 노출
- 모바일의 경우 사용자 업데이트 승인이 오래걸려 메시지 구조 변화를 가할때 주의를 기울여야함

## 2.9 네트워크 주소 변환
- 네트워크 주소 변환(Network Address Translation) : 다른 단말기로 전송되던 패킷의 송신자 주소나 수신자 주소가 다른것으로 변환되는 과정
- NAT 변환을 하는 기기 : 라우터(= 인터넷 공유기)
- 내부에서 포트 매핑 엔트리(Port Mapping Entry)를 만들어(홀펀칭) 내기기와 공유기 외 기기가 서로 대화 할 수 있도록 해줌
